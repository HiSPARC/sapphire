<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial &#8212; SAPPHiRE 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="_static/hisparc_style.css?v=71c9f363" />
    <script src="_static/documentation_options.js?v=51b770b3"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example scripts" href="examples.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Example scripts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SAPPHiRE 2.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tutorial</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading">¶</a></h1>
<p>SAPPHiRE simplifies data access, simulations and analysis for the <a class="reference external" href="https://www.hisparc.nl">HiSPARC</a> experiment.  In this tutorial, we’ll try to give
you a feeling for the things you can do with SAPPHiRE.  How can you
download data?  How can you analyze this data?  How can you produce
pulseheight histograms?  How can you calculate the direction of cosmic
rays?  This tutorial will only give you an overview of what’s possible
with SAPPHiRE.  For details on all available classes and methods, please
see the <a class="reference internal" href="sapphire.html"><span class="doc">SAPPHiRE Reference</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We’ll require you to know basic Python.  If you’re unfamiliar with Python,
you can look at the official <a class="reference external" href="https://docs.python.org/3/tutorial/">Python tutorial</a>, the book <a class="reference external" href="https://greenteapress.com/wp/think-python-2e/">Think Python</a>, or <a class="reference external" href="https://www.scipy-lectures.org/intro/">Getting started with
Python for science</a>.</p>
</div>
<section id="first-steps">
<h2>First steps<a class="headerlink" href="#first-steps" title="Link to this heading">¶</a></h2>
<p>In a few examples, we will plot the data which we have produced.  We make use
of pylab, which is included with matplotlib. If you have Anaconda installed,
you can use the Spyder environment. You can write a script in the main window,
or type short commands in the command prompt in the bottom right. The first
thing you have to do is import everything from pylab. That makes it
ridiculously easy to plot things:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pylab</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>You can also start an IPython terminal with pylab using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipython --pylab
</pre></div>
</div>
<p>In that case, you don’t need to import pylab.</p>
<p>Whenever you see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello, world&#39;</span><span class="p">)</span>
<span class="go">Hello, world</span>
</pre></div>
</div>
<p>it means we’re typing in Python code.  The <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code> is the Python <em>prompt</em>.
It tells you that the Python interpreter is waiting for you to give it
some instructions.  In the above example, we’ve typed in <code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">('Hello,</span>
<span class="pre">world')</span></code>.  The interpreter subsequently executed the code and printed
<em>Hello, world</em> on the screen.</p>
<p>The first thing we’ll have to do to start using SAPPHiRE is to <em>import</em>
the SAPPHiRE module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">sapphire</span>
</pre></div>
</div>
<p>There will be no output if everything is successful.  It is easy to get
some help from inside the Python terminal.  Just say:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">sapphire</span><span class="p">)</span>
</pre></div>
</div>
<p>and you’ll be presented with a basic help screen.  Instead of
<code class="docutils literal notranslate"><span class="pre">sapphire</span></code>, you can throw in modules, packages, functions, classes,
objects, etc.  Everything in Python has <em>some</em> help text associated with
it.  Not all of it is very helpful to a newcomer, hence this tutorial.
All help text is also available in the <a class="reference internal" href="sapphire.html"><span class="doc">SAPPHiRE Reference</span></a>.</p>
</section>
<section id="downloading-and-accessing-hisparc-data">
<h2>Downloading and accessing HiSPARC data<a class="headerlink" href="#downloading-and-accessing-hisparc-data" title="Link to this heading">¶</a></h2>
<p>The SAPPHiRE package comprises multiple modules and packages. To access data
from the public database, we’ll have to import the <a class="reference internal" href="esd.html#module-sapphire.esd" title="sapphire.esd"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.esd</span></code></a> module.
This module gives us access to the <em>event summary data</em>, which is the raw
HiSPARC data with preliminary analysis already included. It is simple to
quickly start playing with data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sapphire</span><span class="w"> </span><span class="kn">import</span> <span class="n">esd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">esd</span><span class="o">.</span><span class="n">quick_download</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span>
<span class="go">100%|####################################|Time: 5.91</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">data8.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Thu Oct 22 16:02:05 2015&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/s102 (Group) &#39;&#39;</span>
<span class="go">/s102/events (Table(46382,)) &#39;&#39;</span>
</pre></div>
</div>
<p>First, we import the <a class="reference internal" href="esd.html#module-sapphire.esd" title="sapphire.esd"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.esd</span></code></a> module. Then, we download data from
station 102 using the <a class="reference internal" href="esd.html#sapphire.esd.quick_download" title="sapphire.esd.quick_download"><code class="xref py py-func docutils literal notranslate"><span class="pre">sapphire.esd.quick_download()</span></code></a> function. This
function downloads yesterday’s data, and creates a datafile on the fly. More on
that later.</p>
<p>If we want to exercise more control, we need to do some things manually. First,
we need the <code class="docutils literal notranslate"><span class="pre">tables</span></code> module to actually store the data. <a class="reference external" href="pytables.org">PyTables</a> is based on the open HDF5 data format, which is used by <a class="reference external" href="https://www.hdfgroup.org/HDF5/users5.html">many
(research) institutes</a>.  For
example, it is used by the KNMI and by NASA.  To specify the date and time for
which to download the data, we need the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> module.  Thus, we have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sapphire</span><span class="w"> </span><span class="kn">import</span> <span class="n">esd</span>
</pre></div>
</div>
<p>Creating an empty data file, with the name <code class="docutils literal notranslate"><span class="pre">mydata.h5</span></code>, is done easily:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;mydata.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">'w'</span></code> means <em>write</em>, which creates a file for writing (and reading).
Mind that this will create an empty file.  If there already was a file
with that name, it will be overwritten!  Alternatively, you can say
<code class="docutils literal notranslate"><span class="pre">'a'</span></code>, which means <em>append</em>, thus adding to an existing file without
overwriting its contents.  Finally, you can specify <code class="docutils literal notranslate"><span class="pre">'r'</span></code> for
<em>read-only</em>.</p>
<section id="downloading-data">
<h3>Downloading data<a class="headerlink" href="#downloading-data" title="Link to this heading">¶</a></h3>
<p>To download data, we have to specify the date/time <em>range</em>.  If we want to
download data from the December 1, 2012 all through December 2, 2012,
we can specify this by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Mind that if we do not specify the hour of day, it is taken to be 00:00
hours.  Thus, there is no data included for December 3.  Alternatively,
we can download data from a two hour interval on October 17 by specifying
the hour of day:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
</pre></div>
</div>
<p>which is from 19:00 to 21:00 hours.  It is important to realize that we use a
GPS clock, which is equal to UTC (up to some leap seconds).  So, if we download
data for a station in the Netherlands, we have just said from 20:00 to 22:00
local time (when it’s not summer time).  You can specify the time up to the
second.</p>
<p>We have not actually done anything yet.  We have just stored our time
window in two arbitrarily-named variables, <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code>.  To
download data from station 501 and store it in a group with name <code class="docutils literal notranslate"><span class="pre">/s501</span></code>,
we can use the <a class="reference internal" href="esd.html#sapphire.esd.download_data" title="sapphire.esd.download_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">sapphire.esd.download_data()</span></code></a> function. Since we’ve
imported <code class="docutils literal notranslate"><span class="pre">esd</span></code> from <code class="docutils literal notranslate"><span class="pre">sapphire</span></code>, we can drop the <code class="docutils literal notranslate"><span class="pre">sapphire</span></code> prefix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">esd</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;/s501&#39;</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="go">100%|####################################|Time: 0:00:16</span>
</pre></div>
</div>
<p>It will show a progressbar to indicate the progress of the download.</p>
<p>As you can see in the reference documentation of
<a class="reference internal" href="esd.html#sapphire.esd.download_data" title="sapphire.esd.download_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">sapphire.esd.download_data()</span></code></a>, available by either clicking on
the link or typing in <code class="docutils literal notranslate"><span class="pre">help(esd.download_data)</span></code> in the
interpreter, the function takes six arguments: <em>file, group, station_number,
start, end</em> and <em>type</em>.  The last one has the default argument
<em>‘events’</em>, and may be omitted, as we have done here.  In our example, we
have opened a file, <code class="docutils literal notranslate"><span class="pre">mydata.h5</span></code>, and have stored the file <em>handler</em> in
the variable <code class="docutils literal notranslate"><span class="pre">data</span></code>.  So, we passed <code class="docutils literal notranslate"><span class="pre">data</span></code> to the function.  The group
name is <code class="docutils literal notranslate"><span class="pre">/s501</span></code>.  Group names in PyTables are just like folders in a
directory hierarchy.  So, we might have specified
<code class="docutils literal notranslate"><span class="pre">/path/to/my/hisparc/data/files/for_station/s501</span></code>.  It is important to
note that this has absolutely nothing to do with <em>files</em>.  Whatever path
you specify, it is all contained <em>inside</em> your data file.  Since this is
just a small data file, we have opted for a simple structure.  At the
moment, just one group named <code class="docutils literal notranslate"><span class="pre">s501</span></code> at the root of the hierarchy.  Group
names must start with a letter, hence the <code class="docutils literal notranslate"><span class="pre">s</span></code> for station.</p>
<p>The <em>station_number</em> is simply the station number.  Here, we’ve chosen to
download data for station 501, located at Nikhef.  The <em>start</em> and <em>end</em>
parameters specify the date/time range.</p>
<p>Finally, <em>type</em> selects whether to download event or weather data should
be downloaded.  We’ve selected the default, which is <em>events</em>. We can also
download the weather data by changing the type to <code class="docutils literal notranslate"><span class="pre">'weather'</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">esd</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;/s501&#39;</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;weather&#39;</span><span class="p">)</span>
<span class="go">100%|####################################|Time: 0:00:10</span>
</pre></div>
</div>
<p>To access the raw data that includes the original detector traces the
<a class="reference internal" href="publicdb.html#sapphire.publicdb.download_data" title="sapphire.publicdb.download_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">sapphire.publicdb.download_data()</span></code></a> function can be used instead. However,
downloading data will take much longer that way. If only some traces need to be
accessed, the <a class="reference internal" href="api.html#module-sapphire.api" title="sapphire.api"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.api</span></code></a> is a better choice. We’ll use that module
later in the tutorial.</p>
</section>
<section id="looking-around">
<h3>Looking around<a class="headerlink" href="#looking-around" title="Link to this heading">¶</a></h3>
<p>If you want to know what groups and tables are contained within the data
file, just <code class="docutils literal notranslate"><span class="pre">print</span></code> it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">mydata.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Sat Dec 29 14:50:55 2012&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/s501 (Group) &#39;Data group&#39;</span>
<span class="go">/s501/events (Table(137600,)) &#39;HiSPARC coincidences table&#39;</span>
<span class="go">/s501/weather (Table(51513,)) &#39;HiSPARC weather data&#39;</span>
</pre></div>
</div>
<p>The <em>object tree</em> gives an overview of all groups and tables.  As you can
see, the <code class="docutils literal notranslate"><span class="pre">/s501</span></code> group contains two tables, <code class="docutils literal notranslate"><span class="pre">events</span></code> and <code class="docutils literal notranslate"><span class="pre">weather</span></code>.
The events table contains the data from the HiSPARC scintillators, while
the weather table contains data from the (optional) weather station.</p>
<p>To directly access any object in the hierarchy, you can make use of the
<code class="docutils literal notranslate"><span class="pre">data.root</span></code> object, which points to the root group.  Then, just specify
the remaining path, with dots instead of slashes.  For example, to access
the events table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
<span class="go">/s501/events (Table(137600,)) &#39;HiSPARC coincidences table&#39;</span>
</pre></div>
</div>
<p>If you want, you can also access the object using its name as a string, by calling <code class="docutils literal notranslate"><span class="pre">get_node</span></code> on the file handler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/s501/events&#39;</span><span class="p">))</span>
<span class="go">/s501/events (Table(137600,)) &#39;HiSPARC coincidences table&#39;</span>
</pre></div>
</div>
<p>Of course, we’d like to get some more information.  You can drop the print
statement, and just access the object directly.  PyTables is set up such
that it will give more detailed information whenever you specify the
object directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">events</span>
<span class="go">/s501/events (Table(137600,)) &#39;&#39;</span>
<span class="go">  description := {</span>
<span class="go">  &quot;event_id&quot;: UInt32Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  &quot;timestamp&quot;: Time32Col(shape=(), dflt=0, pos=1),</span>
<span class="go">  &quot;nanoseconds&quot;: UInt32Col(shape=(), dflt=0, pos=2),</span>
<span class="go">  &quot;ext_timestamp&quot;: UInt64Col(shape=(), dflt=0, pos=3),</span>
<span class="go">  &quot;pulseheights&quot;: Int16Col(shape=(4,), dflt=0, pos=4),</span>
<span class="go">  &quot;integrals&quot;: Int32Col(shape=(4,), dflt=0, pos=5),</span>
<span class="go">  &quot;n1&quot;: Float32Col(shape=(), dflt=0.0, pos=6),</span>
<span class="go">  &quot;n2&quot;: Float32Col(shape=(), dflt=0.0, pos=7),</span>
<span class="go">  &quot;n3&quot;: Float32Col(shape=(), dflt=0.0, pos=8),</span>
<span class="go">  &quot;n4&quot;: Float32Col(shape=(), dflt=0.0, pos=9),</span>
<span class="go">  &quot;t1&quot;: Float32Col(shape=(), dflt=0.0, pos=10),</span>
<span class="go">  &quot;t2&quot;: Float32Col(shape=(), dflt=0.0, pos=11),</span>
<span class="go">  &quot;t3&quot;: Float32Col(shape=(), dflt=0.0, pos=12),</span>
<span class="go">  &quot;t4&quot;: Float32Col(shape=(), dflt=0.0, pos=13),</span>
<span class="go">  &quot;t_trigger&quot;: Float32Col(shape=(), dflt=0.0, pos=14)}</span>
<span class="go">  byteorder := &#39;little&#39;</span>
<span class="go">  chunkshape := (819,)</span>
</pre></div>
</div>
<p>There you go!  But what does it all <em>mean</em>?  Well, if you want to get to
the bottom of it, read the <a class="reference external" href="http://www.pytables.org/usersguide/index.html">PyTables documentation</a>.  We’ll give a quick
overview here.</p>
<p>First, this table contains 137600 rows.  In total, there are fourteen
columns: <code class="docutils literal notranslate"><span class="pre">event_id</span></code>, <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>, <code class="docutils literal notranslate"><span class="pre">nanoseconds</span></code>, <code class="docutils literal notranslate"><span class="pre">ext_timestamp</span></code>,
<code class="docutils literal notranslate"><span class="pre">pulseheights</span></code>, <code class="docutils literal notranslate"><span class="pre">integrals</span></code>, <code class="docutils literal notranslate"><span class="pre">n1</span></code>-<code class="docutils literal notranslate"><span class="pre">n4</span></code>, <code class="docutils literal notranslate"><span class="pre">t1</span></code>-<code class="docutils literal notranslate"><span class="pre">t4</span></code> and
<code class="docutils literal notranslate"><span class="pre">t_trigger</span></code>.</p>
<p>Each event has a unique <a class="footnote-reference brackets" href="#event-id" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> identifier, <code class="docutils literal notranslate"><span class="pre">event_id</span></code>.  Each
event has a Unix timestamp in GPS time, <em>not</em> UTC.  A <a class="reference external" href="https://en.wikipedia.org/wiki/Unix_time">Unix timestamp</a> is the number of seconds that
have passed since January 1, 1970.  The sub-second part of the timestamp
is given in <code class="docutils literal notranslate"><span class="pre">nanoseconds</span></code>.  The <code class="docutils literal notranslate"><span class="pre">ext_timestamp</span></code> is the full
timestamp in nanoseconds. Since there cannot exist another event with the same
timestamp, this field in combination with the station number uniquely
identifies the event. The <code class="docutils literal notranslate"><span class="pre">pulseheights</span></code> and <code class="docutils literal notranslate"><span class="pre">integrals</span></code> fields are
values derived from the PMT traces by the HiSPARC DAQ.  The <code class="docutils literal notranslate"><span class="pre">n#</span></code>
columns are derived from the <code class="docutils literal notranslate"><span class="pre">integrals</span></code> and the <code class="docutils literal notranslate"><span class="pre">t#</span></code> and
<code class="docutils literal notranslate"><span class="pre">t_trigger</span></code> fields are obtained after analyzing the event traces on
the server. For some fields there are four values, one for each detector.
If a station only has two detectors, the values for the missing two
detectors are -1.  If the baseline of the trace could not be determined
all these values are -999.</p>
<p>We’ll get to work with this data in a moment.  First, we’ll take a look at
the weather table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">weather</span>
<span class="go">/s501/weather (Table(51513,)) &#39;HiSPARC weather data&#39;</span>
<span class="go">  description := {</span>
<span class="go">  &quot;event_id&quot;: UInt32Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  &quot;timestamp&quot;: Time32Col(shape=(), dflt=0, pos=1),</span>
<span class="go">  &quot;temp_inside&quot;: Float32Col(shape=(), dflt=0.0, pos=2),</span>
<span class="go">  &quot;temp_outside&quot;: Float32Col(shape=(), dflt=0.0, pos=3),</span>
<span class="go">  &quot;humidity_inside&quot;: Int16Col(shape=(), dflt=0, pos=4),</span>
<span class="go">  &quot;humidity_outside&quot;: Int16Col(shape=(), dflt=0, pos=5),</span>
<span class="go">  &quot;barometer&quot;: Float32Col(shape=(), dflt=0.0, pos=6),</span>
<span class="go">  &quot;wind_dir&quot;: Int16Col(shape=(), dflt=0, pos=7),</span>
<span class="go">  &quot;wind_speed&quot;: Int16Col(shape=(), dflt=0, pos=8),</span>
<span class="go">  &quot;solar_rad&quot;: Int16Col(shape=(), dflt=0, pos=9),</span>
<span class="go">  &quot;uv&quot;: Int16Col(shape=(), dflt=0, pos=10),</span>
<span class="go">  &quot;evapotranspiration&quot;: Float32Col(shape=(), dflt=0.0, pos=11),</span>
<span class="go">  &quot;rain_rate&quot;: Float32Col(shape=(), dflt=0.0, pos=12),</span>
<span class="go">  &quot;heat_index&quot;: Int16Col(shape=(), dflt=0, pos=13),</span>
<span class="go">  &quot;dew_point&quot;: Float32Col(shape=(), dflt=0.0, pos=14),</span>
<span class="go">  &quot;wind_chill&quot;: Float32Col(shape=(), dflt=0.0, pos=15)}</span>
<span class="go">  byteorder := &#39;little&#39;</span>
<span class="go">  chunkshape := (1310,)</span>
</pre></div>
</div>
<p>We’ll let these column names speak for themselves.</p>
</section>
<section id="accessing-the-data">
<h3>Accessing the data<a class="headerlink" href="#accessing-the-data" title="Link to this heading">¶</a></h3>
<p>We can access the data in several ways.  We can address the complete
table, or just one or several rows from it.  We can read out a single
column, or select data based on a query.  Before we do any of that, we’ll
save us some typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">events</span>
</pre></div>
</div>
<p>Now, we have stored a short-hand reference to the events table. Let’s get
the first event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0L, 1445385601, 613271528L, 1445385601613271528L, [3, 266, 400, 372],</span>
<span class="go"> [0, 3090, 5695, 5621], 0.0, 1.03120, 1.55130, 1.58820,</span>
<span class="go"> -999.0, 1002.5, 1000.0, 1022.5, 1030.0, -999.0, -999.0)</span>
</pre></div>
</div>
<p>That’s the first event!  It is not, however, immediately clear what
numbers correspond to which columns.  They are in order, however, so you
could find out.  It is often easier to specify the column you’re
interested in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pulseheights&#39;</span><span class="p">]</span>
<span class="go">array([  3, 266, 400, 372], dtype=int16)</span>
</pre></div>
</div>
<p>Which gives us the pulseheights of the first event.  You can recognize the same
numbers in the full event data above. The pulseheights are 16-bit integers
(that’s the <code class="docutils literal notranslate"><span class="pre">dtype=int16</span></code>) and are determined after digitizing the events
using an analog-digital converter (ADC).  Each unit corresponds to about -0.57
mV.  You can tell that all but the first detector had relatively large
pulseheights, and that they were registered as a significant <em>peak</em> in the
signal.</p>
<p>If you’re interested in the pulseheights of <em>all</em> events, the fastest way
to do it is to make use of the <code class="docutils literal notranslate"><span class="pre">Table.col</span></code> method of the table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">events</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;pulseheights&#39;</span><span class="p">)</span>
<span class="n">array</span><span class="p">([[</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">372</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">277</span><span class="p">,</span> <span class="mi">887</span><span class="p">,</span>   <span class="mi">7</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span>   <span class="mi">6</span><span class="p">,</span> <span class="mi">330</span><span class="p">],</span>
       <span class="o">...</span><span class="p">,</span>
       <span class="p">[</span><span class="mi">162</span><span class="p">,</span>  <span class="mi">78</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span> <span class="mi">299</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">10</span><span class="p">,</span>   <span class="mi">6</span><span class="p">,</span> <span class="mi">618</span><span class="p">,</span> <span class="mi">446</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">593</span><span class="p">,</span> <span class="mi">621</span><span class="p">,</span> <span class="mi">343</span><span class="p">,</span>  <span class="mi">13</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int16</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to select the data based on a query.  For example, to
select all events between timestamps 1354320000 and 1354323600 (a one-hour
time span):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="mi">1354320000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="mi">3600</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sel_events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">read_where</span><span class="p">(</span><span class="s1">&#39;(t0 &lt;= timestamp) &amp; (timestamp &lt; t1)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sel_events</span><span class="p">)</span>
<span class="go">2836</span>
</pre></div>
</div>
<p>Thus, we have selected 2836 events.  The variable <code class="docutils literal notranslate"><span class="pre">sel_events</span></code> no longer
points to a table.  We can no longer make use of the <code class="docutils literal notranslate"><span class="pre">Table.col</span></code>
method, but we <em>can</em> access all pulseheights in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sel_events</span><span class="p">[</span><span class="s1">&#39;pulseheights&#39;</span><span class="p">]</span>
<span class="go">array([[173,   3, 407,   3],</span>
<span class="go">       [  1,   2, 313, 756],</span>
<span class="go">       [211,   2,   2, 268],</span>
<span class="go">       ...,</span>
<span class="go">       [328, 556, 255,  15],</span>
<span class="go">       [  3, 325, 309,   3],</span>
<span class="go">       [  2,   2, 271, 381]], dtype=int16)</span>
</pre></div>
</div>
<p>This notation is possible for arrays, but not for tables.  So, for tables,
use the <code class="docutils literal notranslate"><span class="pre">Table.col</span></code> method.  For arrays, use this special notation.</p>
</section>
<section id="the-sapphire-time-util-module">
<h3>The <a class="reference internal" href="time_util.html#module-sapphire.time_util" title="sapphire.time_util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.time_util</span></code></a> module<a class="headerlink" href="#the-sapphire-time-util-module" title="Link to this heading">¶</a></h3>
<p>SAPPHiRE includes a handy module: <a class="reference internal" href="time_util.html#module-sapphire.time_util" title="sapphire.time_util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.time_util</span></code></a>.  This saves you
from the hassle of converting timestamps and confusing local time and GPS (or
UTC) time.  It is important to realize that the HiSPARC station uses a GPS
clock, and thus saves all timestamps in GPS time, which is certainly not local
time!  You can look up <a class="reference external" href="https://en.wikipedia.org/wiki/Global_Positioning_System#Timekeeping">GPS time</a>, but
suffice it to say that it is <em>almost</em> equal to UTC time.  The difference is the
leap seconds introduced after 1980.  In January 2013, GPS time was ahead of UTC
by 16 seconds.  Since July 2015, it is ahead by 17 seconds. We will not refer
to UTC or local time, but instead always refer to GPS time!</p>
<p>While you tell SAPPHiRE to download data using year, month, day, hour,
minutes, seconds notation, the events table contains timestamps.  It is
often hard to convert between the two.  For example, the correct
conversion between a GPS date/time and a GPS timestamp is given by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">())</span>
<span class="go">1354320000</span>
</pre></div>
</div>
<p>Which is, at best, cumbersome.  It is easy, however, to screw up and
inadvertently convert to local time.  For your benefit, we have included
the <a class="reference internal" href="time_util.html#sapphire.time_util.GPSTime" title="sapphire.time_util.GPSTime"><code class="xref py py-class docutils literal notranslate"><span class="pre">sapphire.time_util.GPSTime</span></code></a> class.  You instantiate the class
by giving it a GPS time to work with.  It can either be in date/time
notation, or as a timestamp.  For example, the exact same result is
obtained by these two last lines of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">sapphire.time_util</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">1354320000</span><span class="p">)</span>
</pre></div>
</div>
<p>If you store the instance, you can then call several methods to convert
the date/time to whatever you require:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
<span class="go">datetime.datetime(2012, 12, 1, 0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sat Dec  1 00:00:00 2012&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="go">1354320000</span>
</pre></div>
</div>
<p>Or, indeed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">1354320000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
<span class="go">datetime.datetime(2012, 12, 1, 0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sat Dec  1 00:00:00 2012&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gpstime</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="go">1354320000</span>
</pre></div>
</div>
<p>It is now easy to select events occurring between 12:00 and 13:00 hours GPS
time on December 2, 2012:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">gpstimestamp</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t0</span><span class="p">,</span> <span class="n">t1</span>
<span class="go">(1354449600, 1354453200)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sel_events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">read_where</span><span class="p">(</span><span class="s1">&#39;(t0 &lt;= timestamp) &amp; (timestamp &lt; t1)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sel_events</span><span class="p">)</span>
<span class="go">2817</span>
</pre></div>
</div>
<p>And when did the tenth event occur?  Well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">sel_events</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">1354449620</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sapphire</span><span class="o">.</span><span class="n">time_util</span><span class="o">.</span><span class="n">GPSTime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sun Dec  2 12:00:20 2012&#39;</span>
</pre></div>
</div>
<p>To shorten the typing somewhat, remember that in Python you can import
classes from modules into your own namespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sapphire.time_util</span><span class="w"> </span><span class="kn">import</span> <span class="n">GPSTime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">GPSTime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
<span class="go">&#39;Sun Dec  2 12:00:20 2012&#39;</span>
</pre></div>
</div>
</section>
<section id="plotting-data">
<h3>Plotting data<a class="headerlink" href="#plotting-data" title="Link to this heading">¶</a></h3>
<p>Now that we can access the data, we want to visualize it.  Plotting data
is a great way to do that.  And of course, the venerable histogram is
still very useful to condense thousands of events into one display.  Pylab
contains an easy function to do just that: <code class="docutils literal notranslate"><span class="pre">hist</span></code>.  Let’s try to
recreate a few graphs as seen on the HiSPARC <a class="reference external" href="https://data.hisparc.nl/show/stations/501/2012/12/1/">data display</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ph</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;pulseheights&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
<span class="go">([array([114794,  17565,   3062,   1009,    502,    285,    170,     86,</span>
<span class="go">           72,     55]), array([112813,  19028,   3339,   1246,    540,    295,    163,    100,</span>
<span class="go">           66,     10]), array([109162,  21833,   4246,   1345,    579,    290,    113,     32,</span>
<span class="go">            0,      0]), array([109996,  21283,   4028,   1285,    581,    251,    133,     43,</span>
<span class="go">            0,      0])], array([  1.00000000e+00,   3.91100000e+02,   7.81200000e+02,</span>
<span class="go">         1.17130000e+03,   1.56140000e+03,   1.95150000e+03,</span>
<span class="go">         2.34160000e+03,   2.73170000e+03,   3.12180000e+03,</span>
<span class="go">         3.51190000e+03,   3.90200000e+03]), &lt;a list of 4 Lists of Patches objects&gt;)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tutorial-hist-simple.png"><img alt="_images/tutorial-hist-simple.png" src="_images/tutorial-hist-simple.png" style="width: 500px;" />
</a>
<p>This will not do.  Firstly, data from the four detectors is pictured as
four side-by-side colored bars.  Secondly, the number of bins is very low;
it is only ten.  Thirdly, the data range continues up to very high values
with hardly any events.</p>
<p>To fix this, we’ll make use of several arguments that can be passed to the
<code class="docutils literal notranslate"><span class="pre">hist</span></code> function.  We’ll also make use of some NumPy (<a class="reference external" href="https://docs.scipy.org/doc/numpy/user/">documentation</a>) functionality.  For Pylab
documentation, see the <a class="reference external" href="https://matplotlib.org">Matplotlib site</a>.
Try this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bins</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hist</span><span class="p">(</span><span class="n">ph</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Pulseheight [ADC]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Pulseheight histogram (log scale)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">linspace</span></code> function returns an array with range from 0 to 2000 with a
total number of 101 values. The first value is 0, the last is 2000. These are
the <em>edges</em> of the bins. So, 101 values means exactly 100 bins between 0 and
2000. The <code class="docutils literal notranslate"><span class="pre">hist</span></code> function will then plot a <em>stepped</em> histogram with a log
scale.  Finally, we add some labels and a title.  This is the result:</p>
<a class="reference internal image-reference" href="_images/tutorial-hist-better.png"><img alt="_images/tutorial-hist-better.png" src="_images/tutorial-hist-better.png" style="width: 500px;" />
</a>
<p>In this plot, the gamma and charged particle part of the spectrum are easy
to distinguish.  The cut at 123 ADC is due to the trigger.  The bump at
approximately 300 ADC is the so-called MIP (minimum ionizing particle)
peak.  For an explanation of this plot and the features of the pulseheight
histogram, see <a class="reference external" href="https://www.nikhef.nl/pub/services/biblio/theses_pdf/thesis_D_Fokkema.pdf">David’s thesis</a>,
page 44–45, and 49–51.</p>
</section>
</section>
<section id="obtaining-coincidences">
<h2>Obtaining coincidences<a class="headerlink" href="#obtaining-coincidences" title="Link to this heading">¶</a></h2>
<p>If you work with HiSPARC data, invariably you’ll be interested in
<em>coincidences</em> between HiSPARC stations.  That is, are there showers
which have been observed by multiple stations?  To find out, we’ll make
use of the <a class="reference internal" href="analysis/coincidences.html#module-sapphire.analysis.coincidences" title="sapphire.analysis.coincidences"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.analysis.coincidences</span></code></a> module.</p>
<section id="performing-the-search">
<h3>Performing the search<a class="headerlink" href="#performing-the-search" title="Link to this heading">¶</a></h3>
<p>Consider the following script, which you can hopefully understand by now
(note that the prompt (<code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>) is absent, since this is a <em>script</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">tables</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sapphire</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_data</span><span class="p">,</span> <span class="n">CoincidencesESD</span>


<span class="n">STATIONS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">501</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">506</span><span class="p">]</span>
<span class="n">START</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">END</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">station_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/s</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">STATIONS</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;data.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">STATIONS</span><span class="p">,</span> <span class="n">station_groups</span><span class="p">):</span>
        <span class="n">download_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, we have downloaded data for three stations. Note that we
used the <a class="reference internal" href="esd.html#module-sapphire.esd" title="sapphire.esd"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.esd</span></code></a> for downloading. Thus, we have no traces
and the download is quick. Let’s see what the datafile now contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">data.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Mon Jan 14 17:34:39 2013&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/s501 (Group) &#39;Data group&#39;</span>
<span class="go">/s501/events (Table(70643,)) &#39;&#39;</span>
<span class="go">/s503 (Group) &#39;Data group&#39;</span>
<span class="go">/s503/events (Table(34937,)) &#39;&#39;</span>
<span class="go">/s506 (Group) &#39;Data group&#39;</span>
<span class="go">/s506/events (Table(68365,)) &#39;&#39;</span>
</pre></div>
</div>
<p>It contains three groups, one for each station.  To search for
coincidences between these stations, we first initialize the
<a class="reference internal" href="analysis/coincidences.html#sapphire.analysis.coincidences.CoincidencesESD" title="sapphire.analysis.coincidences.CoincidencesESD"><code class="xref py py-class docutils literal notranslate"><span class="pre">sapphire.analysis.coincidences.CoincidencesESD</span></code></a> class like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coincidences</span> <span class="o">=</span> <span class="n">CoincidencesESD</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;/coincidences&#39;</span><span class="p">,</span> <span class="n">station_groups</span><span class="p">)</span>
</pre></div>
</div>
<p>From the documentation (click on the class above the example to go to the
documentation) it is clear that we have to specify the datafile
(<code class="docutils literal notranslate"><span class="pre">data</span></code>), the destination group (<code class="docutils literal notranslate"><span class="pre">/coincidences</span></code>) and the groups
containing the station data (<code class="docutils literal notranslate"><span class="pre">station_groups</span></code>).  Once that’s done, there
is an easy way to search for coincidences, process the events making up
the coincidences, and store them in the destination group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coincidences</span><span class="o">.</span><span class="n">search_and_store_coincidences</span><span class="p">(</span><span class="n">station_numbers</span><span class="o">=</span><span class="n">STATIONS</span><span class="p">)</span>
<span class="go">100%|######################################|Time: 0:00:02</span>
<span class="go">100%|######################################|Time: 0:00:00</span>
</pre></div>
</div>
<p>If you want to tweak the process using non-default parameters, see the
module documentation (<a class="reference internal" href="analysis/coincidences.html#module-sapphire.analysis.coincidences" title="sapphire.analysis.coincidences"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.analysis.coincidences</span></code></a>).  For now,
let us turn to the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">data.h5 (File) &#39;&#39;</span>
<span class="go">Last modif.: &#39;Mon Jan 14 17:46:23 2013&#39;</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/coincidences (Group) u&#39;&#39;</span>
<span class="go">/coincidences/c_index (VLArray(2184,)) &#39;&#39;</span>
<span class="go">/coincidences/coincidences (Table(2184,)) &#39;&#39;</span>
<span class="go">/coincidences/s_index (VLArray(3,)) &#39;&#39;</span>
<span class="go">/s501 (Group) &#39;&#39;</span>
<span class="go">/s501/events (Table(70643,)) &#39;&#39;</span>
<span class="go">/s503 (Group) &#39;&#39;</span>
<span class="go">/s503/events (Table(34937,)) &#39;&#39;</span>
<span class="go">/s506 (Group) &#39;&#39;</span>
<span class="go">/s506/events (Table(65935,)) &#39;&#39;</span>
</pre></div>
</div>
<p>The new addition is the <code class="docutils literal notranslate"><span class="pre">/coincidences</span></code> group.  It contains three
tables, which are <code class="docutils literal notranslate"><span class="pre">c_index</span></code>, <code class="docutils literal notranslate"><span class="pre">coincidences</span></code> and <code class="docutils literal notranslate"><span class="pre">s_index</span></code>.
Information about the coincidences is stored in the <code class="docutils literal notranslate"><span class="pre">coincidences</span></code>
table.  Let’s look at the columns:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>column</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>an index number identifying the coincidence</p></td>
</tr>
<tr class="row-odd"><td><p>timestamp</p></td>
<td><p>the unix timestamp</p></td>
</tr>
<tr class="row-even"><td><p>nanoseconds</p></td>
<td><p>the nanosecond part of the timestamp</p></td>
</tr>
<tr class="row-odd"><td><p>ext_timestamp</p></td>
<td><p>the timestamp in nanoseconds</p></td>
</tr>
<tr class="row-even"><td><p>N</p></td>
<td><p>the number of stations taking part in the coincidence</p></td>
</tr>
<tr class="row-odd"><td><p>x</p></td>
<td><p><em>compatibility reasons</em></p></td>
</tr>
<tr class="row-even"><td><p>y</p></td>
<td><p><em>compatibility reasons</em></p></td>
</tr>
<tr class="row-odd"><td><p>azimuth</p></td>
<td><p><em>compatibility reasons</em></p></td>
</tr>
<tr class="row-even"><td><p>zenith</p></td>
<td><p><em>compatibility reasons</em></p></td>
</tr>
<tr class="row-odd"><td><p>size</p></td>
<td><p><em>compatibility reasons</em></p></td>
</tr>
<tr class="row-even"><td><p>energy</p></td>
<td><p><em>compatibility reasons</em></p></td>
</tr>
<tr class="row-odd"><td><p>s501</p></td>
<td><p>flag to indicate if the first station is in coincidence</p></td>
</tr>
<tr class="row-even"><td><p>s503</p></td>
<td><p>as previous but for second station</p></td>
</tr>
<tr class="row-odd"><td><p>s506</p></td>
<td><p>as previous but for third station</p></td>
</tr>
</tbody>
</table>
<p>The columns included for compatibility reasons are used by the event
simulation code.  In that case, the <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> columns give the
position in cartesian coordinates.  Furthermore, the <code class="docutils literal notranslate"><span class="pre">size</span></code> and
<code class="docutils literal notranslate"><span class="pre">energy</span></code> give the so-called <em>shower size</em>, and <code class="docutils literal notranslate"><span class="pre">zenith</span></code> and
<code class="docutils literal notranslate"><span class="pre">azimuth</span></code> contain the direction of the (simulated) shower.  These are
not known for certain when working with HiSPARC data, but are included
nonetheless.  These columns are all set to 0.0.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">c_index</span></code> array is used as an index to look up the tables and
individual events making up a coincidence.  The second coincidence is
accessed by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">coincidences</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">(2L, 1356998460, 730384055L, 1356998460730384055L, 2, 0.0, 0.0, 0.0,</span>
<span class="go"> 0.0, 0.0, 0.0, True, False, True)</span>
</pre></div>
</div>
<p>Remember, the indexes are zero-based.  The coincidence id is also 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">coincidences</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="go">2</span>
</pre></div>
</div>
<p>and the number of stations participating is 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">coincidences</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
<span class="go">2</span>
</pre></div>
</div>
<p>To lookup the indexes of the events taking part in this coincidence,
access the <code class="docutils literal notranslate"><span class="pre">c_index</span></code> array using the same id:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">c_index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="go">array([[ 0, 40],</span>
<span class="go">       [ 2, 57]], dtype=uint32)</span>
</pre></div>
</div>
<p>That is, event id 40 from station 0, event id 57 from station 2 are part
of this coincidence.  The event observables are still stored in their
original location and can be accessed using the ids. To find the
location of the station group the <code class="docutils literal notranslate"><span class="pre">s_index</span></code> contains the paths to the
station groups.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">coincidences</span><span class="o">.</span><span class="n">s_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;/s501&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/s501&#39;</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">)[</span><span class="mi">40</span><span class="p">]</span>
<span class="go">(40L, 1356998460, 730384055L, 1356998460730384055L, [2, 227, 301, 2],</span>
<span class="go"> [0, 1657, 3173, 0], 0.0, 0.5117999911308289, 0.9417999982833862,</span>
<span class="go"> 0.0, -999.0, 12.5, 57.5, -999.0, 62.5)</span>
</pre></div>
</div>
</section>
<section id="downloading-coincidences">
<h3>Downloading coincidences<a class="headerlink" href="#downloading-coincidences" title="Link to this heading">¶</a></h3>
<p>Just like events or weather data for a single station the ESD provides
coincidence data. This means that you can directly download coincidences from
the server. In most cases this can save a lot of disc space, because only
events in a coincidence will be stored.</p>
<p>Downloading coincidences is very similar to downloading data. First import the
required packages, open a PyTables file, and specify the date/time <em>range</em>.
With coincidences two additional options are available, first you can select
which stations you want to consider. This can be <em>all</em> stations in the
network, by not specifying any. It can be a subset of stations by listing
those stations (upto 30 stations), or a cluster of stations by giving the name
of the cluster.</p>
<p>So first import the packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sapphire</span><span class="w"> </span><span class="kn">import</span> <span class="n">esd</span>
</pre></div>
</div>
<p>Set the date/time range:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Open (in this case create) a datafile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;data_coincidences.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then download the coincidences. Here we specify the cluster ‘Enschede’ to
select all stations in that cluster. By setting <em>n</em> to 3 we require that a
coincidence has at least 3 events.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">esd</span><span class="o">.</span><span class="n">download_coincidences</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cluster</span><span class="o">=</span><span class="s1">&#39;Enschede&#39;</span><span class="p">,</span>
<span class="gp">... </span>                          <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>If you now look in the data file it will contain event tables for all stations
with at least one event in a coincidence, and a coincidence table for the
coincidence data. Just like when coincidences were searched manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">Object Tree:</span>
<span class="go">/ (RootGroup) &#39;&#39;</span>
<span class="go">/coincidences (Group) &#39;&#39;</span>
<span class="go">/coincidences/c_index (VLArray(776,)) &#39;&#39;</span>
<span class="go">/coincidences/coincidences (Table(776,)) &#39;&#39;</span>
<span class="go">/coincidences/s_index (VLArray(124,)) &#39;&#39;</span>
<span class="go">/hisparc (Group) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede (Group) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede/station_7001 (Group) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede/station_7001/events (Table(776,)) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede/station_7002 (Group) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede/station_7002/events (Table(776,)) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede/station_7003 (Group) &#39;&#39;</span>
<span class="go">/hisparc/cluster_enschede/station_7003/events (Table(776,)) &#39;&#39;</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="event-id" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Unique in this table.  When data is downloaded for analysis and
combined with other data into one table, the <code class="docutils literal notranslate"><span class="pre">event_id</span></code> will be
different.  To uniquely define an event, use a station number /
<code class="docutils literal notranslate"><span class="pre">ext_timestamp</span></code> combination.</p>
</aside>
</aside>
</section>
</section>
<section id="reconstructions">
<h2>Reconstructions<a class="headerlink" href="#reconstructions" title="Link to this heading">¶</a></h2>
<section id="reconstructing-esd-events">
<h3>Reconstructing ESD Events<a class="headerlink" href="#reconstructing-esd-events" title="Link to this heading">¶</a></h3>
<p>Assume <code class="docutils literal notranslate"><span class="pre">data_s501.h5</span></code> contains events downloaded from the ESD for station
501:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sapphire</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReconstructESDEvents</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;data_s501.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">station_path</span> <span class="o">=</span> <span class="s1">&#39;/s501&#39;</span>  <span class="c1"># location of the event table in datafile</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rec</span> <span class="o">=</span> <span class="n">ReconstructESDEvents</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">station_path</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Constructed object &lt;Station, id: 0, number: 501, cluster:</span>
<span class="go">HiSPARCStations([501])&gt; from public database.</span>
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">verbose=True</span></code> forces the reconstruction class to be
verbose about the metadata about station layout of timing offsets that is
being used. Here, a <code class="docutils literal notranslate"><span class="pre">HiSPARCStations</span></code> object is created which retrieves
metadata from the public database.</p>
<p>Now let’s reconstruct the events and store the results in the datafile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rec</span><span class="o">.</span><span class="n">reconstruct_and_store</span><span class="p">()</span>
<span class="go">Reading detector offsets from public database.</span>
<span class="go">100%|#################################################|Time: 0:00:31</span>
<span class="go">100%|#################################################|Time: 0:00:21</span>
</pre></div>
</div>
<p>The reconstruction class notifies us that detector timing offsets are being
retrieved from the public database. First directions are reconstructed and
subsequently core positions are reconstructed.</p>
<p>The results are stored in the datafile in the <cite>reconstructions</cite> group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">reconstructions</span><span class="p">)</span>
<span class="go">/s501/reconstructions (Table(29569,)) &#39;&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;zenith&#39;</span><span class="p">)</span>
<span class="go">array([ nan,  nan,  nan, ...,  nan,  nan, 0.66482645], dtype=float32)</span>
</pre></div>
</div>
<p>The <cite>nan</cite> values in the zenith angle array are values that cannot be
reconstructed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">isnan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">s501</span><span class="o">.</span><span class="n">reconstructions</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;zenith&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
<span class="go">array([ 0.59542936,  0.74284476,  0.38334498, ...,  0.41376889,</span>
<span class="go">    0.07834953,  0.66482645], dtype=float32)</span>
</pre></div>
</div>
</section>
<section id="reconstructing-simulated-events">
<h3>Reconstructing simulated events<a class="headerlink" href="#reconstructing-simulated-events" title="Link to this heading">¶</a></h3>
<p>Assume the datafile (<cite>data</cite>) contains simulated events, generated by
<a class="reference internal" href="simulations/groundparticles.html#sapphire.simulations.groundparticles.GroundParticlesSimulation" title="sapphire.simulations.groundparticles.GroundParticlesSimulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">sapphire.simulations.groundparticles.GroundParticlesSimulation</span></code></a>.
This class stores the metadata of the simulated station (cluster) in the
hdf5 file, which can be read by the reconstruction class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rec</span> <span class="o">=</span> <span class="n">ReconstructESDEvents</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">station_path</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Read cluster HiSPARCStations([501]) from datafile.</span>
</pre></div>
</div>
<p>The class has read the station (cluster object) from the datafile. This
cluster object contains both the detector locations as well as the
detector timing offsets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rec</span><span class="o">.</span><span class="n">reconstruct_and_store</span><span class="p">()</span>
<span class="go">Read detector offsets from cluster object.</span>
<span class="go">100%|#################################################|Time: 0:00:31</span>
<span class="go">100%|#################################################|Time: 0:00:21</span>
</pre></div>
</div>
<p>Note that the detector (timing) offset from the datafile are used,
and not the offsets from the public database.</p>
</section>
<section id="reconstructing-esd-coinicdences">
<h3>Reconstructing ESD coinicdences<a class="headerlink" href="#reconstructing-esd-coinicdences" title="Link to this heading">¶</a></h3>
<p>Coincidences can be reconstructed analogous to ESD Events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sapphire</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReconstructESDCoincidences</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;data_s501_s502_s503.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rec</span> <span class="o">=</span> <span class="n">ReconstructESDEvents</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Constructed cluster HiSPARCStations([501, 502, 503]) from public</span>
<span class="go">database.</span>
</pre></div>
</div>
<p>The constructed cluster object is created from the stations in the
datafile.</p>
<p>Reconstruct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rec</span><span class="o">.</span><span class="n">reconstruct_and_store</span><span class="p">()</span>
<span class="go">Using timing offsets from public database.</span>
<span class="go">100%|#################################################|Time: 0:00:31</span>
<span class="go">100%|#################################################|Time: 0:00:21</span>
</pre></div>
</div>
</section>
<section id="reconstructing-simulated-coincidences">
<h3>Reconstructing simulated coincidences<a class="headerlink" href="#reconstructing-simulated-coincidences" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ReconstructESDCoincidences</span></code> class can reconstruct simulated
coincidences, using the cluster objects stored by the simulation class
in the datafile analogous to <code class="docutils literal notranslate"><span class="pre">ReconstructESDEvents</span></code>.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/header.png" alt="Logo of SAPPHiRE"/>
            </a></p>
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#first-steps">First steps</a></li>
<li><a class="reference internal" href="#downloading-and-accessing-hisparc-data">Downloading and accessing HiSPARC data</a><ul>
<li><a class="reference internal" href="#downloading-data">Downloading data</a></li>
<li><a class="reference internal" href="#looking-around">Looking around</a></li>
<li><a class="reference internal" href="#accessing-the-data">Accessing the data</a></li>
<li><a class="reference internal" href="#the-sapphire-time-util-module">The <code class="xref py py-mod docutils literal notranslate"><span class="pre">sapphire.time_util</span></code> module</a></li>
<li><a class="reference internal" href="#plotting-data">Plotting data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#obtaining-coincidences">Obtaining coincidences</a><ul>
<li><a class="reference internal" href="#performing-the-search">Performing the search</a></li>
<li><a class="reference internal" href="#downloading-coincidences">Downloading coincidences</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reconstructions">Reconstructions</a><ul>
<li><a class="reference internal" href="#reconstructing-esd-events">Reconstructing ESD Events</a></li>
<li><a class="reference internal" href="#reconstructing-simulated-events">Reconstructing simulated events</a></li>
<li><a class="reference internal" href="#reconstructing-esd-coinicdences">Reconstructing ESD coinicdences</a></li>
<li><a class="reference internal" href="#reconstructing-simulated-coincidences">Reconstructing simulated coincidences</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="installation.html"
                          title="previous chapter">Installation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="examples.html"
                          title="next chapter">Example scripts</a></p>
  </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Example scripts"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SAPPHiRE 2.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tutorial</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2009-2018, David Fokkema, Arne de Laat, and Tom Kooij.
    </div>
  </body>
</html>